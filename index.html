<!doctype html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="theme-color" content="#2c3e50">
        <meta name="description" content="Application de cartographie web pour explorer les donn√©es g√©ographiques de la r√©gion de K√©dougou, S√©n√©gal">
        
        <!-- PWA Manifest -->
        <link rel="manifest" href="manifest.json">
        <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
        <link rel="apple-touch-icon" href="icons/icon.svg">
        <meta name="apple-mobile-web-app-title" content="SIG K√©dougou">
        
        <!-- M√©tadonn√©es PWA avanc√©es -->
        <meta name="keywords" content="cartographie, g√©ographie, k√©dougou, s√©n√©gal, SIG, gis">
        <meta name="author" content="SIG K√©dougou">
        
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/L.Control.Locate.min.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet.photon.css">
        <link rel="stylesheet" href="css/leaflet-measure.css">
        <link rel="stylesheet" href="css/modern-app-style.css">
        <title>Cartographie web de la r√©gion de K√©dougou</title>
    </head>
    <body>
        <!-- Navigation Bar -->
        <nav class="navbar">
            <div class="navbar-container">
                <div class="navbar-brand">
                    <i class="fas fa-map"></i>
                    <span>SIG K√©dougou</span>
                </div>
                <div class="navbar-menu">
                    <button class="navbar-item" data-action="home" title="Accueil">
                        <i class="fas fa-home"></i>
                        <span>Accueil</span>
                    </button>
                    <button class="navbar-item" data-action="about" title="√Ä propos">
                        <i class="fas fa-info-circle"></i>
                        <span>√Ä propos</span>
                    </button>
                    <button class="navbar-item" data-action="catalog" title="Catalogue des donn√©es">
                        <i class="fas fa-database"></i>
                        <span>Catalogue</span>
                    </button>
                    <button class="navbar-item" data-action="spatial-query" title="Requ√™te spatiale">
                        <i class="fas fa-draw-polygon"></i>
                        <span>Requ√™te spatiale</span>
                    </button>
                    <button class="navbar-item" data-action="attribute-query" title="Requ√™te attributaire">
                        <i class="fas fa-filter"></i>
                        <span>Requ√™te attributaire</span>
                    </button>
                    <button class="navbar-item" data-action="download" title="T√©l√©charger les donn√©es">
                        <i class="fas fa-download"></i>
                        <span>T√©l√©chargement</span>
                    </button>
                    <button class="navbar-item" data-action="measure" title="Outils de mesure">
                        <i class="fas fa-ruler"></i>
                        <span>Mesure</span>
                    </button>
                    <button class="navbar-item" data-action="zoom-extent" title="Zoom √† l'√©tendue maximale">
                        <i class="fas fa-expand"></i>
                        <span>Zoom</span>
                    </button>
                    <button class="navbar-item" id="install-app-btn" title="Installer l'application" style="display: none;">
                        <i class="fas fa-download"></i>
                        <span>Installer</span>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content Container -->
        <div class="app-container">
            <!-- Left Panel - Layer Control -->
            <div class="left-panel">
                <div class="panel-header">
                    <h3><i class="fas fa-layers"></i> Couches</h3>
                    <button class="panel-toggle" id="left-panel-toggle" title="Masquer le panneau">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                </div>
                <div class="panel-content" id="layers-container">
                </div>
            </div>

            <!-- Map Container -->
            <div class="map-container">
                <!-- Search Bar -->
                <div class="map-search-container">
                    <input type="text" id="navbar-search-input" class="map-search-bar" placeholder="Chercher un lieu, une localit√©, une √©cole..." />
                    <i class="fas fa-search"></i>
                </div>
                <div id="map"></div>
                <!-- Coordinates Bar -->
                <div class="coordinates-bar">
                    <span class="coord-label">Latitude:</span>
                    <span class="coord-value" id="lat">0.00¬∞</span>
                    <span class="coord-label">Longitude:</span>
                    <span class="coord-value" id="lon">0.00¬∞</span>
                    <span class="coord-label">Zoom:</span>
                    <span class="coord-value" id="zoom-level">1</span>
                </div>
                <!-- Mini Map -->
                <div id="minimap"></div>
            </div>

            <!-- Right Panel - Basemaps and Legend -->
            <div class="right-panel">
                <div class="panel-tabs">
                    <button class="panel-tab-btn active" data-tab="basemaps">
                        <i class="fas fa-globe"></i> Fonds de carte
                    </button>
                    <button class="panel-tab-btn" data-tab="legend">
                        <i class="fas fa-book"></i> L√©gende
                    </button>
                </div>
                
                <div class="panel-tab-content active" id="basemaps-tab">
                    <div class="panel-header">
                        <h3>Fonds de carte</h3>
                        <button class="panel-toggle" id="right-panel-toggle" title="Masquer le panneau">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="basemaps-container" id="basemaps-list">
                    </div>
                </div>

                <div class="panel-tab-content" id="legend-tab">
                    <div class="panel-header">
                        <h3>L√©gende</h3>
                        <button class="panel-toggle" id="right-panel-toggle" title="Masquer le panneau">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="legend-container" id="legend-list">
                    </div>
                </div>
            </div>
        </div>

        <!-- Modals -->
        <!-- Home Modal -->
        <div class="modal" id="homeModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Cartographie web de la r√©gion de K√©dougou</h2>
                    <button class="modal-close" data-modal="homeModal">&times;</button>
                </div>
                <div class="modal-body">
                    <p><strong>Bienvenue sur le SIG de K√©dougou</strong></p>
                    <p>Explorez les donn√©es cartographiques de la r√©gion avec des outils intuitifs :</p>
                    <ul>
                        <li>Consultez les limites administratives</li>
                        <li>Visualisez le r√©seau routier et hydrographique</li>
                        <li>Identifiez les localit√©s et infrastructures</li>
                        <li>Effectuez des requ√™tes spatiales et attributaires</li>
                        <li>Mesurez des distances et des surfaces</li>
                        <li>T√©l√©chargez les donn√©es en GeoJSON</li>
                    </ul>
                    <p style="margin-top: 15px;"><strong>Conseils d'utilisation :</strong></p>
                    <ul>
                        <li>Utilisez les contr√¥les √† gauche pour g√©rer les couches visibles</li>
                        <li>Changez les fonds de carte √† droite</li>
                        <li>Explorez la l√©gende pour comprendre les symboles</li>
                        <li>Cliquez sur les entit√©s pour voir leurs propri√©t√©s</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button class="btn-close" data-modal="homeModal">Fermer</button>
                </div>
            </div>
        </div>

        <!-- Catalog Modal -->
        <div class="modal" id="catalogModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Catalogue des donn√©es</h2>
                    <button class="modal-close" data-modal="catalogModal">&times;</button>
                </div>
                <div class="modal-body">
                    <p>D√©couvrez les couches de donn√©es disponibles dans cette application :</p>
                    <div id="catalog-list" style="margin-top: 15px;">
                        <!-- Populated dynamically -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-close" data-modal="catalogModal">Fermer</button>
                </div>
            </div>
        </div>

        <!-- About Modal -->
        <div class="modal" id="aboutModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>√Ä propos de cette application</h2>
                    <button class="modal-close" data-modal="aboutModal">&times;</button>
                </div>
                <div class="modal-body">
                    <p><strong>Cartographie web de la r√©gion de K√©dougou</strong></p>
                    <p>Projet de cartographie web portant sur :</p>
                    <ul>
                        <li>Les limites administratives</li>
                        <li>Le r√©seau routier</li>
                        <li>Le r√©seau hydrographique</li>
                        <li>Les localit√©s du milieu rural</li>
                        <li>Les √©coles</li>
                    </ul>
                    <p><strong>Technologies utilis√©es :</strong></p>
                    <ul>
                        <li>QGIS</li>
                        <li>Leaflet.js</li>
                        <li>OpenStreetMap</li>
                        <li>Google Maps Satellite</li>
                        <li>CartoDB</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button class="btn-close" data-modal="aboutModal">Fermer</button>
                </div>
            </div>
        </div>

        <!-- Download Modal -->
        <div class="modal" id="downloadModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>T√©l√©charger les donn√©es</h2>
                    <button class="modal-close" data-modal="downloadModal">&times;</button>
                </div>
                <div class="modal-body">
                    <p>S√©lectionnez les couches √† t√©l√©charger :</p>
                    <div class="download-options" id="download-options">
                        <label><input type="checkbox" value="Regions_Senegal" /> R√©gions du S√©n√©gal</label>
                        <label><input type="checkbox" value="Region_Kedougou" /> R√©gion de K√©dougou</label>
                        <label><input type="checkbox" value="Kedougou_Departements" /> D√©partements</label>
                        <label><input type="checkbox" value="Kedougou_Arrondissements" /> Arrondissements</label>
                        <label><input type="checkbox" value="Kedougou_Ecoles" /> √âcoles</label>
                        <label><input type="checkbox" value="Kedougou_Hydrographie" /> Hydrographie</label>
                        <label><input type="checkbox" value="Kedougou_Routes" /> Routes</label>
                        <label><input type="checkbox" value="Kedougou_Localites" /> Localit√©s</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-primary" id="download-btn-geojson">T√©l√©charger en GeoJSON</button>
                    <button class="btn-primary" id="download-btn-csv" style="background: #27ae60;">T√©l√©charger en CSV</button>
                    <button class="btn-close" data-modal="downloadModal">Annuler</button>
                </div>
            </div>
        </div>

        <!-- Spatial Query Modal -->
        <div class="modal" id="spatialQueryModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Requ√™te spatiale</h2>
                    <button class="modal-close" data-modal="spatialQueryModal">&times;</button>
                </div>
                <div class="modal-body">
                    <p>S√©lectionnez un type de requ√™te spatiale :</p>
                    <div class="query-options">
                        <button class="query-btn" data-query="buffer" title="Buffer">
                            <i class="fas fa-circle-notch"></i> Zone tampon
                        </button>
                        <button class="query-btn" data-query="intersection" title="Intersection">
                            <i class="fas fa-project-diagram"></i> Intersection
                        </button>
                        <button class="query-btn" data-query="contains" title="Contient">
                            <i class="fas fa-expand"></i> Contient
                        </button>
                        <button class="query-btn" data-query="distance" title="Distance">
                            <i class="fas fa-ruler-horizontal"></i> Distance
                        </button>
                    </div>
                    <div id="query-details" style="margin-top: 20px; display:none;">
                        <label>Distance (m) : </label>
                        <input type="number" id="buffer-distance" value="100" min="0" max="10000" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-primary" id="apply-query">Appliquer</button>
                    <button class="btn-close" data-modal="spatialQueryModal">Fermer</button>
                </div>
            </div>
        </div>

        <!-- Attribute Query Modal -->
        <div class="modal" id="attributeQueryModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Requ√™te attributaire</h2>
                    <button class="modal-close" data-modal="attributeQueryModal">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Entrez vos crit√®res de recherche :</p>
                    <div class="filter-options">
                        <label for="layer-select">Couche :</label>
                        <select id="layer-select">
                            <option value="">-- S√©lectionner une couche --</option>
                            <option value="Kedougou_Departements">D√©partements</option>
                            <option value="Kedougou_Arrondissements">Arrondissements</option>
                            <option value="Kedougou_Ecoles">√âcoles</option>
                            <option value="Kedougou_Localites">Localit√©s</option>
                        </select>
                        
                        <label for="attribute-select">Attribut :</label>
                        <select id="attribute-select">
                            <option value="">-- S√©lectionner un attribut --</option>
                        </select>
                        
                        <label for="attribute-value">Valeur :</label>
                        <input type="text" id="attribute-value" placeholder="Entrez la valeur √† rechercher" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-primary" id="apply-filter">Rechercher</button>
                    <button class="btn-close" data-modal="attributeQueryModal">Fermer</button>
                </div>
            </div>
        </div>

        <!-- Install App Modal -->
        <div class="modal" id="installAppModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Installer l'application</h2>
                    <button class="modal-close" data-modal="installAppModal">&times;</button>
                </div>
                <div class="modal-body">
                    <p><strong>Installez SIG K√©dougou sur votre appareil!</strong></p>
                    <div style="text-align: center; padding: 20px; background: #f0f0f0; border-radius: 8px; margin: 15px 0;">
                        <i class="fas fa-mobile-alt" style="font-size: 48px; color: #3498db; margin-bottom: 10px;"></i>
                        <p>Acc√©dez √† votre cartographie personnelle directement depuis l'√©cran d'accueil de votre t√©l√©phone.</p>
                    </div>
                    <p><strong>Avantages :</strong></p>
                    <ul>
                        <li>‚úÖ Installation directe sans AppStore</li>
                        <li>‚úÖ Fonctionnement hors ligne compl√®tement</li>
                        <li>‚úÖ G√©olocalisation pr√©cise</li>
                        <li>‚úÖ Acc√®s rapide depuis l'√©cran d'accueil</li>
                        <li>‚úÖ Mises √† jour automatiques</li>
                    </ul>
                    <p style="color: #7f8c8d; font-size: 12px; margin-top: 15px;">
                        Cette application fonctionne sans connexion internet et sauvegarde vos donn√©es localement.
                    </p>
                </div>
                <div class="modal-footer">
                    <button class="btn-primary" id="confirm-install-btn" style="background: #27ae60;">Installer maintenant</button>
                    <button class="btn-close" data-modal="installAppModal">Plus tard</button>
                </div>
            </div>
        </div>

        <!-- Overlay for modal backdrop -->
        <div class="modal-overlay" id="modalOverlay"></div>

        <!-- Install Prompt Banner -->
        <div id="install-prompt-banner" class="install-prompt-banner" style="display: none;">
            <div class="install-prompt-content">
                <div class="install-prompt-left">
                    <i class="fas fa-mobile-alt"></i>
                    <span>Installer SIG K√©dougou sur votre appareil</span>
                </div>
                <div class="install-prompt-right">
                    <button id="install-prompt-btn" class="install-prompt-install">Installer</button>
                    <button id="install-prompt-dismiss" class="install-prompt-dismiss">√ó</button>
                </div>
            </div>
        </div>

        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/L.Control.Locate.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.photon.js"></script>
        <script src="js/leaflet-measure.js"></script>
        <script src="js/pwa-installer.js"></script>
        <script src="data/Regions_Senegal_3.js"></script>
        <script src="data/Region_Kedougou_4.js"></script>
        <script src="data/Kedougou_Departements_5.js"></script>
        <script src="data/Kedougou_Arrondissements_6.js"></script>
        <script src="data/Kedougou_Ecoles_7.js"></script>
        <script src="data/Kedougou_Hydrographie_8.js"></script>
        <script src="data/Kedougou_Routes_9.js"></script>
        <script src="data/Kedougou_Localites_10.js"></script>
        <script src="js/modern-app-script.js"></script>
        <script src="js/layer-definitions.js"></script>
        <script src="js/advanced-features.js"></script>
        <script src="js/geolocation.js"></script>
        
        <!-- Service Worker Registration & PWA Install -->
        <script>
            /**
             * PWA Installation System - SIG K√©dougou
             * G√®re l'enregistrement du Service Worker et l'installation de l'app
             */
            
            // Variables globales
            let deferredPrompt = null;
            let installPromptBanner = document.getElementById('install-prompt-banner');
            let installAppBtn = document.getElementById('install-app-btn');
            let installPromptBtn = document.getElementById('install-prompt-btn');
            let dismissPromptBtn = document.getElementById('install-prompt-dismiss');

            /**
             * 1. ENREGISTREMENT DU SERVICE WORKER
             */
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('sw.js', { scope: '/sig-kedougou/' })
                        .then(registration => {
                            console.log('‚úÖ Service Worker enregistr√© avec succ√®s:', registration);
                            
                            // V√©rifier les mises √† jour
                            registration.addEventListener('updatefound', () => {
                                const newWorker = registration.installing;
                                newWorker.addEventListener('statechange', () => {
                                    if (newWorker.state === 'activated' && navigator.serviceWorker.controller) {
                                        console.log('üì¶ Nouvelle version disponible');
                                        // Afficher une notification
                                        if ('Notification' in window && Notification.permission === 'granted') {
                                            new Notification('SIG K√©dougou', {
                                                body: 'Une nouvelle version est disponible. Rechargez la page.',
                                                icon: 'icons/icon.svg'
                                            });
                                        } else {
                                            // Afficher une banni√®re de mise √† jour
                                            const updateBanner = document.createElement('div');
                                            updateBanner.style.cssText = 'position: fixed; top: 50px; width: calc(100% - 20px); background: #3498db; color: white; padding: 12px 10px; text-align: center; z-index: 9998; border-radius: 4px; margin: 10px;';
                                            updateBanner.innerHTML = 'üì¶ Une nouvelle version est disponible. <button onclick="window.location.reload();" style="background: white; color: #3498db; border: none; padding: 4px 12px; border-radius: 3px; cursor: pointer; margin-left: 10px;">Recharger</button>';
                                            document.body.appendChild(updateBanner);
                                        }
                                    }
                                });
                            });
                        })
                        .catch(error => console.error('‚ùå Erreur lors de l\'enregistrement du Service Worker:', error));
                });
            }

            /**
             * 2. √âV√âNEMENT beforeinstallprompt (Installation PWA)
             */
            window.addEventListener('beforeinstallprompt', (e) => {
                // Emp√™cher l'affichage automatique de la banni√®re du navigateur
                e.preventDefault();
                
                // Sauvegarder l'√©v√©nement pour plus tard
                deferredPrompt = e;
                
                console.log('üíæ beforeinstallprompt captur√© - app installable');
                
                // Afficher notre banni√®re d'installation personnalis√©e
                showInstallPrompt();
                
                // Rendre visible le bouton d'installation dans la navbar
                if (installAppBtn) {
                    installAppBtn.style.display = 'flex';
                }
            });

            /**
             * 3. AFFICHAGE DE LA BANNI√àRE D'INSTALLATION
             */
            function showInstallPrompt() {
                if (installPromptBanner) {
                    installPromptBanner.style.display = 'block';
                    console.log('üì≤ Banni√®re d\'installation affich√©e');
                }
            }

            /**
             * 4. GESTIONNAIRES D'√âV√âNEMENTS D'INSTALLATION
             */
            
            // Bouton d'installation dans la banni√®re
            if (installPromptBtn) {
                installPromptBtn.addEventListener('click', async () => {
                    if (!deferredPrompt) {
                        console.warn('‚ùå deferredPrompt non disponible');
                        return;
                    }
                    
                    // Afficher le dialogue d'installation
                    deferredPrompt.prompt();
                    
                    // Attendre la r√©ponse de l'utilisateur
                    const { outcome } = await deferredPrompt.userChoice;
                    
                    if (outcome === 'accepted') {
                        console.log('‚úÖ Utilisateur a accept√© l\'installation');
                        hideInstallPrompt();
                        showInstallSuccessNotification();
                    } else {
                        console.log('‚ùå Utilisateur a refus√© l\'installation');
                    }
                    
                    deferredPrompt = null;
                });
            }

            // Bouton de fermeture de la banni√®re
            if (dismissPromptBtn) {
                dismissPromptBtn.addEventListener('click', () => {
                    hideInstallPrompt();
                    console.log('‚úã Banni√®re d\'installation ferm√©e');
                });
            }

            // Bouton d\'installation dans la navbar
            if (installAppBtn) {
                installAppBtn.addEventListener('click', async () => {
                    if (!deferredPrompt) {
                        console.warn('‚ö†Ô∏è L\'application est d√©j√† install√©e ou son installation n\'est pas disponible');
                        // Ouvrir le modal d'info
                        openModal('installAppModal');
                        return;
                    }
                    
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    
                    if (outcome === 'accepted') {
                        console.log('‚úÖ App install√©e via le bouton navbar');
                        hideInstallPrompt();
                        showInstallSuccessNotification();
                        installAppBtn.style.display = 'none';
                    }
                    
                    deferredPrompt = null;
                });
            }

            /**
             * 5. CACHER LA BANNI√àRE D'INSTALLATION
             */
            function hideInstallPrompt() {
                if (installPromptBanner) {
                    installPromptBanner.style.display = 'none';
                }
            }

            /**
             * 6. NOTIFICATION DE SUCC√àS D'INSTALLATION
             */
            function showInstallSuccessNotification() {
                // Notification syst√®me
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification('SIG K√©dougou install√©e!', {
                        body: 'L\'application est maintenant install√©e sur votre √©cran d\'accueil.',
                        icon: 'icons/icon.svg',
                        badge: 'icons/icon-192x192.png',
                        tag: 'install-success',
                        requireInteraction: false
                    });
                }
                
                // Message dans la console
                console.log('üéâ L\'application a √©t√© install√©e avec succ√®s!');
            }

            /**
             * 7. DEMANDER LES PERMISSIONS
             */
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    console.log('üîî Permission Notification:', permission);
                });
            }

            /**
             * 8. GESTION DE L'√âT√â INSTALLED - quand l'app est d√©j√† install√©e
             */
            window.addEventListener('appinstalled', () => {
                console.log('üéâ PWA install√©e avec succ√®s!');
                hideInstallPrompt();
                if (installAppBtn) {
                    installAppBtn.style.display = 'none';
                }
                deferredPrompt = null;
            });

            /**
             * 9. GESTION DU MODE OFFLINE/ONLINE
             */
            document.addEventListener('offline', () => {
                console.log('üì¥ Mode hors ligne activ√©');
                const banner = document.createElement('div');
                banner.id = 'offline-banner';
                banner.style.cssText = 'position: fixed; top: 50px; width: calc(100% - 20px); background: #e74c3c; color: white; padding: 12px 10px; text-align: center; z-index: 9999; border-radius: 4px; margin: 10px; font-weight: 500;';
                banner.textContent = '‚ö†Ô∏è Vous √™tes hors ligne. Certaines fonctionnalit√©s peuvent ne pas fonctionner.';
                if (!document.getElementById('offline-banner')) {
                    document.body.insertBefore(banner, document.body.firstChild);
                }
            });
            
            document.addEventListener('online', () => {
                console.log('üì° Connexion r√©tablie');
                const banner = document.getElementById('offline-banner');
                if (banner) {
                    banner.style.display = 'none';
                    setTimeout(() => banner.remove(), 300);
                }
            });

            /**
             * 10. D√âTECTION DE LA PLATEFORME
             */
            function detectPlatform() {
                const ua = navigator.userAgent;
                if (/Android/.test(ua)) {
                    console.log('üì± Plateforme: Android');
                    return 'android';
                } else if (/iPhone|iPad|iPod|Mac OS/.test(ua)) {
                    console.log('üì± Plateforme: iOS');
                    return 'ios';
                } else if (/Windows|Linux/.test(ua)) {
                    console.log('üíª Plateforme: Desktop');
                    return 'desktop';
                }
                return 'unknown';
            }

            // Afficher les infos au chargement
            window.addEventListener('load', () => {
                console.log('üöÄ SIG K√©dougou charg√©e');
                console.log('Platform:', detectPlatform());
                console.log('PWA Support:', 'serviceWorker' in navigator ? '‚úÖ' : '‚ùå');
                console.log('Notifications:', 'Notification' in window ? '‚úÖ' : '‚ùå');
                console.log('Geolocation:', 'geolocation' in navigator ? '‚úÖ' : '‚ùå');
            });

            /**
             * 11. MODAL HELPER (si la fonction openModal n'existe pas)
             */
            function openModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'block';
                    const overlay = document.getElementById('modalOverlay');
                    if (overlay) overlay.style.display = 'block';
                }
            }
        </script>

        <!-- Styles pour la banni√®re d'installation -->
        <style>
            .install-prompt-banner {
                position: fixed;
                bottom: 20px;
                left: 20px;
                right: 20px;
                background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
                color: white;
                padding: 16px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 9997;
                animation: slideUp 0.3s ease-out;
            }

            .install-prompt-content {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 20px;
            }

            .install-prompt-left {
                display: flex;
                align-items: center;
                gap: 12px;
                flex: 1;
                font-weight: 500;
            }

            .install-prompt-left i {
                font-size: 24px;
            }

            .install-prompt-right {
                display: flex;
                gap: 8px;
            }

            .install-prompt-install {
                background: white;
                color: #3498db;
                padding: 8px 16px;
                border: none;
                border-radius: 4px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .install-prompt-install:hover {
                transform: scale(1.05);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            }

            .install-prompt-dismiss {
                background: rgba(255, 255, 255, 0.2);
                color: white;
                border: none;
                font-size: 24px;
                width: 36px;
                height: 36px;
                border-radius: 50%;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 0;
            }

            .install-prompt-dismiss:hover {
                background: rgba(255, 255, 255, 0.3);
            }

            @keyframes slideUp {
                from {
                    transform: translateY(100px);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }

            @media (max-width: 600px) {
                .install-prompt-banner {
                    bottom: 10px;
                    left: 10px;
                    right: 10px;
                    padding: 12px;
                }

                .install-prompt-content {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 12px;
                }

                .install-prompt-right {
                    align-self: flex-end;
                }
            }
        </style>

    </body>
</html>
